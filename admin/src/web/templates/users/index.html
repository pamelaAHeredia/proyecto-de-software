{% extends "layout.html" %}
{% block title %}Usuarios{% endblock %}
{% block head %}
{{ super() }}
{% endblock %}
{% block content %}

<h1>Usuarios</h1>

<div class="container">
  <h3>Filtrar listado por: </h3>
  <form action="{{ url_for('users.users_filter_by')}}" method="post">
    <div class="form group">
      {{ filter_form.filter(class="")}}
      {{filter_form.hidden_tag()}}
      <button class="btn btn btn-primary block" type="submit">filtar</button>  
    </div>
  </form>
</div>

{% if users %}
<table class="table table-hover table-sm">
  <thead>
    <tr>
      <th>#</th>
      <th>Email</th>
      <th>Nombre de Usuario</th>
      <th>Estado</th>
      <th>Nombre</th>
      <th>Apellido</th>
      <th>Operaciones</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <th>{{ user.id }}</th>
      <th>{{ user.email }}</th>
      <th>{{ user.username }}</th>
      <th>{%if user.blocked -%} {{"Bloqueado"}}
        {%else -%}
        {{"Activo"}}
        {% endif %}</th>
      <th>{{ user.first_name }}</th>
      <th>{{ user.last_name }}</th>
      <th>
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
            aria-expanded="false">
            Operaciones
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="{{url_for('users.user_info', id=user.id)}}">Ver usuario</a></li>
            <li><a class="dropdown-item" href="{{url_for('users.users_update', id=user.id)}}">Editar Usuario</a></li>
            <li><a class="dropdown-item" href="{{url_for('users.users_add_roles', id=user.id)}}">Ver roles</a></li>
            {% for role in user.roles %} 
            {% if not role.name == "Administrador" %}
            <li>
              <a class="dropdown-item" href="{{url_for('users.users_block', id=user.id)}}">
                {% if user.blocked %}
                {{"Desbloquear"}}
                {% else %}
                {{"Bloquear"}}
                {% endif %}
            </a>
          </li>
          {% endif %}
          {% endfor %}
          </ul>
        </div>
      </th>
      </th>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<h2>No hay usuarios para mostrar</h2>
{% endif %}


<a href="{{url_for('home')}}"> Volver al inicio </a>
{% endblock %}